---
title: "Differential Equation"
author: "Roshan Rai"
date: "`r Sys.Date()`"
output:
  pdf_document:
    df_print: kable
    keep_tex: true
    latex_engine: xelatex
    toc: false
fontsize: 11pt
classorientation: landscape
bookdown::pdf_book:
  citation_package: biblatex
header-includes:
  - \usepackage{setspace}
  - \usepackage{float}
  - \usepackage{subfig}
editor_options: 
  markdown: 
    wrap: 72
---

```{r, libraries, echo = FALSE, warning = FALSE, message = FALSE}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(jtools)
library(scales)
library(latex2exp)
library(deSolve)
library(phaseR)
```

\onehalfspacing

**This note contains parts that I learnt from the Differential equation
course of Rice university in edx.org. The code for rmarkdown can be
obtained
[*https://raw.githubusercontent.com/Roshann-Rai/differential-equation/main/differential.Rmd*](https://raw.githubusercontent.com/Roshann-Rai/differential-equation/main/differential.Rmd){.uri}**

# 1. Differential Equation

A differential equation of simple form $\frac{dy}{dt} + P(t)y = f(t)$
explains how the change in one variable (independent variable) affects
the other dependent variable. It shows the direction of movement as well
as the magnitude of the movement of dependent variable with respect the
indpendent variable. It can be (i) ordinary differential equation that
has 1 independent variable, (ii) partial differential equation that has
at least 2 independent variables.

## 1.1 Solution of differential equation

**a. General Solution** includes all the possible solutions that
typically includes arbitrary constant. For eg. $y(t) = t^3 + c$ is a
general solution.\
**b. Particular Solution** includes the solution without arbitrary
constant. Consider the intial condition: $$y(t_0) = 0$$ $$c = 0$$ So,
$$y(t) = t^3$$ \clearpage

```{r difference1, echo = F, warning=F, message=F, fig.cap = "Plot of $y = t^3$", include=TRUE, fig.align = "center"}
sim <- data.frame(t = seq(-7,7), by = 1) %>%
  mutate(y = t^3)

ggplot(sim, aes(x = t)) +
  geom_smooth(aes(y = y), linewidth = 1.5, color = "#69b3a2") +
  annotate("text", fontface = "bold", x = 5, y = 280,
           label = "Y[t] == t^3", parse = TRUE) +
  scale_y_continuous(limits = c(-300,300), n.breaks = 6) +
  scale_x_continuous(limits = c(-7,7), n.breaks = 6) + 
  labs(
    title = "",
    x = "",
    y = ""
  ) + 
  theme_minimal() +
  geom_vline(aes(xintercept = 0), linetype = "dashed") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  theme(
    axis.text = element_text(size = 10)
  )
```

## 1.2 Order of Differential Equation

The order of the differential equation is the highest derivative of the
dependent variable that exists in the equation.
$$\frac{d^ny}{dt} = f(t, y^1, y^2,...., y^{n-1}, y^n)$$ is the $n-th$
order differential equation.\
First order differential equation is $$\frac{dy}{dt} = f(t, y)$$

## 1.3 Directional Fields

Directional field also known as slope field is the graphical
representation of the solutions to the first order differential
equation. Consider the differential equation,
$$\frac{dy}{dt} = (y-2)(y+1)(1-y)^2$$ To determine the directional
field, we equate the above equation equals to 0,
$$(y-2)(y+1)(1-y)^2 = 0$$ So, $y = 2, \pm1$. The graph is divided into
four regions i.e. $y <-1$, $-1 < y < 1$, $1 < y < 2$ and $y > 2$.\
For, $y < -1, \frac{dy}{dt} = 36$ when $y = -2$,\
For, $-1 < y < 1, \frac{dy}{dt} = -1.05$ when $y = -0.9$\
For, $1 < y < 2, \frac{dy}{dt} = -0.0189$ when $y = 1.1$\
For, $y > 2, \frac{dy}{dt} = 0.3751$ when $y = 2.1$\

```{r difference2, echo = F, warning=F, message=F, results = "hide", fig.keep='last', fig.cap = "Directional field of $\\frac{dy}{dt}=(y-2)(y+1)(1-y)^2$", fig.pos = "h"}
differential_equation <- function(t, y, parameters){
  a <- parameters[1]  
  dy <- a*(y - 2)*(y + 1)*(1 - y)^2
  list(dy)
}

# Generate the flow field plot
flowField(differential_equation, xlim = c(0, 5), ylim = c(-2, 3), points = 19, system = "one.dim", add = FALSE, xlab = "t", ylab = "y", parameters = c(1))
grid()
abline(h = 2, col = "blue", lty = 2)  # Nullcline at y = 2
abline(h = -1, col = "blue", lty = 2)  # Nullcline at y = -1
abline(h = 1, col = "blue", lty = 2)  # Nullcline at y = 1
```

## 1.4 Concavity

The graph of $f(x)$ is concave up if $f'(x)$ is increasing i.e. $f'>0$
and concave down if $f'(x)$ is decreasing i.e. $f'(x)<0$.

\clearpage

```{r caption, echo = F, warning = F}
captions <- c("Convex function (Concave upward)", "Concave function (Concave downward)")
```

```{r difference3, echo = F, warning=F, message=F, fig.cap = "Plot of $y = t^2$", include=TRUE, fig.cap = "", fig.subcap=captions, out.width='.49\\linewidth', fig.asp=1, fig.ncol = 2}
sim1 <- data.frame(t = seq(-4,4), by = 1) %>%
  mutate(y = t^2)
ggplot(sim1, aes(x = t)) +
  geom_smooth(aes(y = y), linewidth = 1.5, color = "#69b3a2") +
  annotate("text", fontface = "bold", x = 2.3, y = 8,
           label = "Y[t] == t^2", parse = TRUE, size = 6) +
  scale_y_continuous(limits = c(0,10), n.breaks = 6) +
  scale_x_continuous(limits = c(-4,4), n.breaks = 6) + 
  labs(
    title = "",
    x = "",
    y = ""
  ) + 
  theme_minimal() +
  geom_vline(aes(xintercept = 0), linetype = "dashed") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  theme(
    axis.text = element_text(size = 12)
  )

sim2 <- data.frame(t = seq(-4,4), by = 1) %>%
  mutate(y = -(t^2))

ggplot(sim2, aes(x = t)) +
  geom_smooth(aes(y = y), linewidth = 1.5, color = "#69b3a2") +
  annotate("text", fontface = "bold", x = 2.3, y = -8,
           label = "Y[t] == -t^2", parse = TRUE, size = 6) +
  scale_y_continuous(limits = c(-16, 0), n.breaks = 6) +
  scale_x_continuous(limits = c(-4,4), n.breaks = 6) + 
  labs(
    title = "",
    x = "",
    y = ""
  ) + 
  theme_minimal() +
  geom_vline(aes(xintercept = 0), linetype = "dashed") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  theme(
    axis.text = element_text(size = 12)
  )
```

## 1.5 Separable equations

Differential equation is separable if $y'=f(t)g(y)$.\

**Example:** $$\frac{dy}{dt} = 3t^2(1+y)$$

$$
\frac{1}{1+y}dy = 3t^2dt \tag{1}
$$

$$
\int\frac{1}{1+y}dy = \int3t^2dt
$$

$$
ln|{1+y}|=t^3 + c
$$

$$
e^{ln|1+y|}=e^{t^3+c}
$$

$$
|1+y|=e^{t^3}.e^c 
$$

$$
1+y = \pm e^ce^{t^3} \tag{2}
$$

where $e^c>0$ in equation (1).

$$
y = Ke^{t^3}
$$

$$
y = -1 + Ke^{t^3}
$$

$$
y = -1 + Ce^{t^3} \tag{3}
$$

In equation (3),

a\. If $C = 0$, $y=-1$ is equilibrium solution.

b\. If $C \neq 0$, it gives all other possible solutions.

**Example:**

$$
\frac{dy}{dt}=\frac{3t^2+1}{1+2y}
$$

and $y(0) = 1$

The equation is in the form $y'=f(t)g(y)$. So the equation can be
separated.

Does the equation has equilibrium solution?

Set, $g(y) = 0$, $\Longrightarrow$ $\frac{1}{1+2y} = 0$. So, no
equilibrium solution.

Now,

$$
\int(1+2y)dy=\int(3t^2+1)dt
$$

$$
y+y^2=t^3+t+c \tag{1}
$$

Put $y(0) = 1$, then $C = 2$. So,

$$
y+y^2=t^3+t+2
$$

$$
(y^2+y)-(t^3+t+2)=0 \tag{2}
$$

Equation (2) is in the form of $ax^2+bx+c = 0$, where $a = 1$, $b = 1$
and $c = -(t^3+t+2)$.

$$
y = \frac{-1\pm\sqrt{1+4(t^3+t+2)}}{2}
$$

```{r difference4, echo = F, warning=F, message=F, results = "hide", fig.keep='last', fig.cap = "Plot of $y^2+y-(t^3+t+2)=0$", fig.pos = "h"}
# Function to solve for y given t
solve_y <- function(t) {
  a <- 1
  b <- 1
  c <- -(t^3+t+2)
  discriminant <- b^2-4*a*c
  
  # Check if discriminant is non-negative
  if (discriminant < 0) {
    return(data.frame(y_t = NA, t = t)) # No real solution
  } else {
    y1 <- (-b + sqrt(discriminant)) / (2*a)
    y2 <- (-b - sqrt(discriminant)) / (2*a)
    return(data.frame(y_t = c(y1, y2), t = t))
  }
}

# Generate a sequence of t values
t_values <- seq(-3, 3, by = 0.1)

# Solve for y values
solutions <- bind_rows(lapply(t_values, solve_y))

#solutions <- na.omit(solutions)

data <- solutions %>%
  group_by(t) %>%
  mutate(id = row_number()) %>%
  ungroup()

# Reshape the data frame to have separate columns for repeated t values
reshaped_data <- data %>%
  pivot_wider(names_from = id, values_from = y_t, names_prefix = "y_t")

ggplot(reshaped_data, aes(x = t)) +
  geom_smooth(aes(y = y_t1), linewidth = 1.5, color = "#69b3a2", se=FALSE) +
  geom_smooth(aes(y = y_t2), linewidth = 1.5, color = "#69b3a2", se=FALSE) +
  annotate("text", fontface = "bold", x = 1.3, y = 4.2,
           label = "y^2+y-(t^3+t+2)==0", parse = TRUE, size = 4) +
  scale_y_continuous(limits = c(-7,5), n.breaks = 6) +
  scale_x_continuous(limits = c(-2,4), n.breaks = 7) + 
  labs(
    title = "",
    x = "",
    y = ""
  ) + 
  theme_minimal() +
  geom_vline(aes(xintercept = 0), linetype = "dashed") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  theme(
    axis.text = element_text(size = 12)
  )
```

## 1.6 Picard's Theorem

For $y' = f(t,y)$ with $y(t_0)=y_0$ to have solution:

-   Condition I: f(t,y) should be continuous function[^1] in a
    neighborhood of $t_0,y_0$.
-   Condition II: The solution is unique if $\frac{\delta f}{\delta y}$
    is also continuous in neighbourhood of this initial condition $t_0$
    and $y_0$.\

[^1]: A function $f(x)$ is continous at $x=a$ if a. $f(a)$ is defined,
    b. $\lim_{x \to a} f(x)$ exists and c. $\lim_{x \to a} f(x) = f(a)$

## 1.7 Linearity vs Non-linearity

A linear differential equation is in the form $y'+p(t)y=f(t)$ which is a
first order linear differential equation. Non-linear differential
equation can be $y'y=cost$. Properties of linear equations are:

-   **Superposition principle**: If $y_1$ and $y_2$ are homogeneous
    solutions, their linear combinations $c_1y_1 + c_2y_3$ is also
    homogeneous.
-   **Non homogeneous principle**: General solution for non-homogeneous
    equation is $y(t) = y_P + y_H$ where $y_P$ is solution for
    non-homogeneous equation and $y_H$ is solution for homogeneous
    equation.

\newpage

# 2. First order Differential Equation

## 2.1 First order linear non-homogeneous Equation: Variation of Parameters

Consider the following first order ODE: $$y'+p(t)y=f(t) \tag{1}$$ For
equation (1), $$y_H=Ce^{-\int{p(t)dt}} \tag{2}$$ $$y_p=vy_H \tag{3}$$
Can $v$ be constant?\
No, $v$ can't be constant because if $v$ is constant then $y_p$ is
scalar multiplicative of $y_H$. This won't solve the non-homogeneous
equation. $v$ is non-constant function of $t$ i.e. $v(t)$.

From equation (3), $$y_p'=(vy_H)' \longrightarrow v'y_H+vy_H'$$ So, in
equation (1), $$v'y_H+vy_H'+p(t)vy_H=f(t)$$
$$v'y_H+v[y_H'+p(t)y_H]=f(t)$$ where $y'_H+p(t)y_H=0$ $$v'y_H=f(t)$$
$$v'=\frac{f(t)}{y_H}$$ $$v=\int\frac{f(t)}{y_H}dt \tag{4}$$ Equation
(4) gives $v$.

**Example:** $$y'+\frac{1}{1+t}y=2$$ $$y(0)=0, t\geq0$$
$$y_H=Ce^{-\int\frac{1}{1+t}dt}$$ $$y_H=Ce^{-ln|1+t|}$$
$$y_H=Ce^{ln|1+t|^{-1}}$$ $$y_H=C|1+t|^{-1}$$
$$y_H=\frac{C}{1+t} \tag{1}$$ Here we only take +ve sign because
$t\geq0$. $$y_P=vy_H$$ $$v'=\frac{f}{y_H}$$
$$v'=\frac{f}{\frac{1}{1+t}}$$ $$v'=2(1+t)$$ where $f=2$
$$v=\int{2(1+t)}dt$$ $$v=2t+t^2+c \tag{2}$$ Now, $$y_P=(2t+t^2+c)y_H$$
$$y_P=\frac{(t^2+2t+c)}{1+t} \tag{3}$$ Here, we don't need to write $c$
because we will get the constant from $y_H$. General Solution is
$$y=y_P+y_H$$ $$y=\frac{2t+t^2}{t+1}+\frac{C}{t+1} \tag{4}$$ We know,
$y(0)=0$ so, $$0=\frac{2*0+0^2}{0+1}+\frac{c}{0+1}$$ $$c=0$$ Hence,
$$y=\frac{2t+t^2}{t+1} \tag{5}$$ Eqn (5) is case when $t\neq-1$.
\newpage

## 2.2 First order linear non-homogeneous equation: Integrating Factors

Consider the following $$y'+p(t)y=f(t) \tag{1}$$ Multiply equation (1)
by $\mu$, $$\mu y'+p(t)y\mu=f(t)\mu$$ Assume, $\mu p(t) = \mu'$\
Now, $$\mu y'+\mu' y=\mu f(t)$$ $$(\mu y)'=\mu f(t)$$
$$\int{(\mu y)'dt}=\int{\mu f(t)dt}$$ $$\mu y +c = \int{\mu f(t)dt}$$
$$y = \frac{\int{\mu f(t)dt}-c}{\mu} \tag{2}$$ In eqn (2), since c is
unknown constant, we change the sign -ve to +ve.
$$y = \frac{\int{\mu f(t)dt}+c}{\mu} \tag{3}$$ From our assumption,
$$\mu p(t)=\mu' \longrightarrow p(t)=\frac{\mu'}{\mu}$$ On right hand
side, it is simply the natural log of $\mu$. So, $$p(t)=(ln\mu)'$$
$$\int{p(t)dt}=\int{(ln\mu)' dt}$$ $$\int{p(t)dt+k}=\ln\mu$$
$$\mu = e^{\int{p(t)dt}+k}$$ $$\mu = e^ke^{\int{p(t)dt}}$$
$$\mu = Ke^{\int{p(t)dt}} \tag{4}$$ where $K=e^k$.\
If we set the value of $\mu$ in equation 3, we get y,
$$y = \frac{\int{Ke^{\int{p(t)dt}} f(t)dt}+c}{Ke^{\int{p(t)dt}}} \tag{5}$$

**Example** $$y' + \frac{1}{t+1}=2$$ and $y(0)=0, t \geq 0$\
We Know, $$\mu = e^{\int{p(t)dt}}$$ $$\mu = e^{\int{\frac{1}{1+t}dt}}$$
$$\mu = e^{ln|1+t|}$$ $$\mu = |1+t|$$ $$\mu = t+1$$ We only take
positive sign because $t \geq 0$. $$(\mu y)' = \mu f(t)$$
$$(\mu y)' = 2\mu$$ $$[(1+t)y]'=2(1+t)$$
$$\int{[(1+t)y]'dt}=\int{2(1+t)dt}$$ $$(1+t)y=t^2+2t+c$$
$$y=\frac{t^2+2t}{t+1}+\frac{c}{t+1} \tag{1}$$ Since,
$y(0)=0$ so, $c = 0$ in equation (1). Then,
$$y(t)=\frac{t^2+2t}{t+1} \tag{2}$$
\newpage

# 3. Second order Differential Equation

General form of Second order differential equation is in the form

$$
ay''+by'+cy=f(t)
$$

## 3.1 With constant coefficient

To find $y_H = Basis$ ${y_1, y_2}$ where $y_1, y_2$ are two linearly independent functions.
$$y(t)=e^{\lambda t}$$
$$y'(t)=\lambda e^{\lambda t}$$
$$y''(t)=\lambda^2 e^{\lambda t}$$
Then,
$$a\lambda^2 e^{\lambda t} + b\lambda e^{\lambda t} + c e^{\lambda t} = 0$$
$$e^{\lambda t}(a\lambda^2 +b\lambda + c) = 0$$
Since, $e^{\lambda t} \neq 0$ so,
$$a\lambda^2 +b\lambda + c= 0$$
$$\lambda_{1,2} = \frac{-b\pm\sqrt{b^2-4ac}}{2a}$$

+ $b^2-4ac>0$ $\Longrightarrow$ Real distinct roots
+ $b^2-4ac=0$ $\Longrightarrow$ Repeated roots
+ $b^2-4ac<0$ $\Longrightarrow$ Complex Roots

















